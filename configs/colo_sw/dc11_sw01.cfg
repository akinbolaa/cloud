---
feature bgp
feature lacp
feature interface-vlan
feature vpc
feature ssh

interface loopback0
description default vrf loopback
ip address 10.137.68.25/32
!

vrf context vpc_keepalive
!
vlan 675
  name AZCD21
  !
vrf context AZCD21
  description ibgp vlan for vrf AZCD21
  rd 64919:675
  address-family ipv4 unicast
  !
interface vlan 675
  description ibgp vlan for vrf AZCD21
  no shutdown
  vrf member AZCD21
  ip address 10.137.64.125/30
  !
vlan 676
  name AZCQ21
  !
vrf context AZCQ21
  description ibgp vlan for vrf AZCQ21
  rd 64919:676
  address-family ipv4 unicast
  !
interface vlan 676
  description ibgp vlan for vrf AZCQ21
  no shutdown
  vrf member AZCQ21
  ip address 10.137.64.189/30
  !
vlan 677
  name AZCP21
  !
vrf context AZCP21
  description ibgp vlan for vrf AZCP21
  rd 64919:677
  address-family ipv4 unicast
  !
interface vlan 677
  description ibgp vlan for vrf AZCP21
  no shutdown
  vrf member AZCP21
  ip address 10.137.64.61/30
  !
vlan 1675
  name AZCD21-OUT
  !
vrf context AZCD21-OUT
  description ibgp vlan for vrf AZCD21-OUT
  rd 64919:1675
  address-family ipv4 unicast
  !
interface vlan 1675
  description ibgp vlan for vrf AZCD21-OUT
  no shutdown
  vrf member AZCD21-OUT
  ip address 10.137.64.241/30
  !
vlan 1676
  name AZCQ21-OUT
  !
vrf context AZCQ21-OUT
  description ibgp vlan for vrf AZCQ21-OUT
  rd 64919:1676
  address-family ipv4 unicast
  !
interface vlan 1676
  description ibgp vlan for vrf AZCQ21-OUT
  no shutdown
  vrf member AZCQ21-OUT
  ip address 10.137.64.245/30
  !
vlan 1677
  name AZCP21-OUT
  !
vrf context AZCP21-OUT
  description ibgp vlan for vrf AZCP21-OUT
  rd 64919:1677
  address-family ipv4 unicast
  !
interface vlan 1677
  description ibgp vlan for vrf AZCP21-OUT
  no shutdown
  vrf member AZCP21-OUT
  ip address 10.137.64.249/30
  !
!
interface loop675
  description  vrf AZCD21 loopback for testing
  vrf member AZCD21
  ip address 10.137.68.2/32
!
interface loop676
  description  vrf AZCQ21 loopback for testing
  vrf member AZCQ21
  ip address 10.137.68.3/32
!
interface loop677
  description  vrf AZCP21 loopback for testing
  vrf member AZCP21
  ip address 10.137.68.1/32
!
interface loop175
  description  vrf AZCD21-OUT loopback for testing
  vrf member AZCD21-OUT
  ip address 10.137.68.33/32
!
interface loop176
  description  vrf AZCQ21-OUT loopback for testing
  vrf member AZCQ21-OUT
  ip address 10.137.68.34/32
!
interface loop177
  description  vrf AZCP21-OUT loopback for testing
  vrf member AZCP21-OUT
  ip address 10.137.68.35/32
!
!
interface ethernet1/1
 no shutdown
 switchport mode trunk
 channel-group 1 mode active
!
interface ethernet1/2
 no shutdown
 switchport mode trunk
 channel-group 1 mode active
!
interface port-channel1
 no shutdown
 switchport mode trunk
 vpc peer-link
!
interface ethernet1/3
no shutdown
no switchport
vrf member vpc_keepalive
ip add 10.137.64.253/30

vpc domain 100
 peer-keepalive destination 10.138.64.254 source 10.137.64.253 vrf vpc_keepalive
!
interface ethernet1/4
  no shutdown
  no switchport
!
interface ethernet1/5
  no shutdown
  no switchport
!
interface ethernet1/6
  no shutdown
  no switchport
!
interface ethernet1/7
  no shutdown
  no switchport
!
interface ethernet1/8
  no shutdown
  no switchport
!
interface ethernet1/9
  no shutdown
  no switchport
!
interface ethernet1/4.675
  no shutdown
  encapsulation dot1q 675
  vrf member AZCD21-OUT
  ip address 10.137.64.109/30
!
interface ethernet1/4.676
  no shutdown
  encapsulation dot1q 676
  vrf member AZCQ21-OUT
  ip address 10.137.64.173/30
!
interface ethernet1/4.677
  no shutdown
  encapsulation dot1q 677
  vrf member AZCP21-OUT
  ip address 10.137.64.45/30
!
interface ethernet1/5.675
  no shutdown
  encapsulation dot1q 675
  vrf member AZCD21-OUT
  ip address 10.137.64.117/30
!
interface ethernet1/5.676
  no shutdown
  encapsulation dot1q 676
  vrf member AZCQ21-OUT
  ip address 10.137.64.181/30
!
interface ethernet1/5.677
  no shutdown
  encapsulation dot1q 677
  vrf member AZCP21-OUT
  ip address 10.137.64.53/30
!
interface ethernet1/7.675
  no shutdown
  encapsulation dot1q 675
  vrf member AZCD21
  ip address 10.137.66.1/30
!
interface ethernet1/7.676
  no shutdown
  encapsulation dot1q 676
  vrf member AZCQ21
  ip address 10.137.66.9/30
!
interface ethernet1/7.677
  no shutdown
  encapsulation dot1q 677
  vrf member AZCP21
  ip address 10.137.66.17/30
!
interface ethernet1/8.675
  no shutdown
  encapsulation dot1q 675
  vrf member AZCD21
  ip address 10.137.64.74/30
!
interface ethernet1/8.676
  no shutdown
  encapsulation dot1q 676
  vrf member AZCQ21
  ip address 10.137.64.138/30
!
interface ethernet1/8.677
  no shutdown
  encapsulation dot1q 677
  vrf member AZCP21
  ip address 10.137.64.10/30
!
interface ethernet1/9.675
  no shutdown
  encapsulation dot1q 675
  vrf member AZCD21
  ip address 10.137.64.82/30
!
interface ethernet1/9.676
  no shutdown
  encapsulation dot1q 676
  vrf member AZCQ21
  ip address 10.137.64.146/30
!
interface ethernet1/9.677
  no shutdown
  encapsulation dot1q 677
  vrf member AZCP21
  ip address 10.137.64.18/30
!
interface ethernet1/6.675
  no shutdown
  encapsulation dot1q 675
  vrf member AZCD21-OUT
  ip address 10.137.66.5/30
!
interface ethernet1/6.676
  no shutdown
  encapsulation dot1q 676
  vrf member AZCQ21-OUT
  ip address 10.137.66.13/30
!
interface ethernet1/6.677
  no shutdown
  encapsulation dot1q 677
  vrf member AZCP21-OUT
  ip address 10.137.66.21/30
!
 
route-map REDIS_CONNECTED-VRF-AZCT21-OUT permit 10
 match interface ethernet1/6.675
route-map REDIS_CONNECTED-VRF-AZCT21-OUT permit 10
 match interface ethernet1/6.676
route-map REDIS_CONNECTED-VRF-AZCT21-OUT permit 10
 match interface ethernet1/6.677
router bgp 64919
  address-family ipv4 unicast
  vrf AZCP21
  address-family ipv4 unicast
network 10.137.68.1/32
    neighbor 10.137.64.62
    remote-as 64919
    address-family ipv4 unicast
     next-hop-self
        neighbor 10.137.64.9
    remote-as 65188
    address-family ipv4 unicast
        neighbor 10.137.64.17
    remote-as 65188
    address-family ipv4 unicast
        neighbor 10.137.66.18
    remote-as 64521
    address-family ipv4 unicast
    !
  vrf AZCD21
  address-family ipv4 unicast
  network 10.137.68.2/32
    neighbor 10.137.64.126
    remote-as 64919
    address-family ipv4 unicast
     next-hop-self
        neighbor 10.137.64.73
    remote-as 65188
    address-family ipv4 unicast
        neighbor 10.137.64.81
    remote-as 65188
    address-family ipv4 unicast
        neighbor 10.137.66.2
    remote-as 64523
    address-family ipv4 unicast
    !
vrf AZCQ21
address-family ipv4 unicast
network 10.137.68.3/32
    neighbor 10.137.64.190
    remote-as 64919
    address-family ipv4 unicast
     next-hop-self
        neighbor 10.137.64.137
    remote-as 65188
    address-family ipv4 unicast
        neighbor 10.137.64.145
    remote-as 65188
    address-family ipv4 unicast
        neighbor 10.137.66.10
    remote-as 64522
    address-family ipv4 unicast
    !
vrf AZCD21-OUT
redistribute direct route-map REDIS_CONNECTED-VRF-AZCD21-OUT
address-family ipv4 unicast
 network 10.137.68.33/32
    neighbor 10.137.64.246
    remote-as 64919
    address-family ipv4 unicast
 next-hop-self
  
    neighbor 10.137.64.110
    remote-as 64854
    address-family ipv4 unicast
  
    neighbor 10.137.64.118
    remote-as 64854
    address-family ipv4 unicast
  
!
vrf AZCQ21-OUT
address-family ipv4 unicast
redistribute direct route-map REDIS_CONNECTED-VRF-AZCQ21-OUT
network 10.137.68.34/32
    neighbor 10.137.64.250
    remote-as 64919
    address-family ipv4 unicast
     next-hop-self
        neighbor 10.137.64.174
    remote-as 64854
    address-family ipv4 unicast
        neighbor 10.137.64.182
    remote-as 64854
    address-family ipv4 unicast
    !
vrf AZCP21-OUT
address-family ipv4 unicast
redistribute direct route-map REDIS_CONNECTED-VRF-AZCP21-OUT
network 10.137.68.35/32
    neighbor 10.137.64.242
    remote-as 64919
    address-family ipv4 unicast
     next-hop-self
        neighbor 10.137.64.46
    remote-as 64854
    address-family ipv4 unicast
        neighbor 10.137.64.54
    remote-as 64854
    address-family ipv4 unicast
    